!function(e){function t(t){for(var n,a,i=t[0],c=t[1],u=t[2],l=0,f=[];l<i.length;l++)a=i[l],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&f.push(o[a][0]),o[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(d&&d(t);f.length;)f.shift()();return s.push.apply(s,u||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,i=1;i<r.length;i++){var c=r[i];0!==o[c]&&(n=!1)}n&&(s.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},o={2:0},s=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var i=window.webpackJsonp=window.webpackJsonp||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var d=c;s.push([193,0,8]),r()}({193:function(e,t,r){e.exports=r(247)},21:function(e,t,r){"use strict";function n(e){return`${e.host}${e.path}`}function o(e){const t=e.match(/^([^:]+):\/\/([^/]+)?(\/.*)?$/);if(!t)return;let r=t[2]||"";const n=r.indexOf(":");n>=0&&(r=r.slice(0,n));let o=t[3]||"";const s=o.indexOf("#");if(s>=0&&(o=o.slice(0,s)),!r.startsWith(".")){if(!o){if(!r)return;o="/"}return{host:r,path:o}}}function s(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".*").replace(/^\.\*\\\./,"(.*\\.)?")+"$").test(t)}function a(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$").test(t)}function i(e,t){let r;if(r="string"==typeof t?o(t):t,r)return{isHostMatch:{ruleHost:e.host,urlHost:r.host,matches:s(e.host,r.host)},isPathMatch:{rulePath:e.path,urlPath:r.path,matches:a(e.path,r.path)}}}function c(e,t,r){let n,i;n="string"==typeof e?o(e):e;let c=!1,u=!1;if(n){const e=e=>{const t=function(e,t){let r;if(r="string"==typeof t?o(t):t,r)return s(e.host,r.host)&&a(e.path,r.path)}(e,n);return t&&(i=e),t};c=r.some(e),c||(u=t.some(e))}return{urlParts:n,matchedRule:i,whiteListMatched:c,blackListMatched:u}}function u(e,t,r){const n=c(e,t,r);return!n.urlParts||n.whiteListMatched||!n.blackListMatched}r.d(t,"e",(function(){return n})),r.d(t,"a",(function(){return o})),r.d(t,"d",(function(){return i})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u}))},22:function(e,t,r){"use strict";var n=r(98);class o extends n.a{constructor(){super("hcfy"),this.version(2).stores({historyRecords:"id,date",favorites:"id,date,text"}),this.historyRecords=this.table("historyRecords"),this.favorites=this.table("favorites")}}t.a=new o},247:function(e,t,r){"use strict";r.r(t);var n=r(117);r(194);const o=new n.a,s=new n.c,a=new n.b;function i(e){switch(e){case"YouDaoWeb":return s;case"BaiDuWeb":return o;case"GoogleWeb":return a}}var c=r(7),u=r(50);const d=Object(u.a)(c.a,["destination","secondDestination"]);let l;var f,w,b=r(37);let p,h;browser.windows.onRemoved.addListener((e=>{p===e&&(p=void 0)})),(null===(w=null===(f=null===window||void 0===window?void 0:window.chrome)||void 0===f?void 0:f.windows)||void 0===w?void 0:w.onBoundsChanged)&&chrome.windows.onBoundsChanged.addListener((e=>{e.id===p&&browser.storage.local.set({panelPos:Object(u.a)(e,["width","height","left","top"])})}));const v=Object(u.a)(c.a,["panelPos"]);async function m(e=""){if(void 0!==p&&void 0!==h)browser.tabs.sendMessage(h,{action:"translateInPopup",data:e}),browser.windows.update(p,{focused:!0});else{const t=await browser.storage.local.get(v),r=await browser.windows.create({url:browser.runtime.getURL("panel.html")+"?text="+encodeURIComponent(e),type:"popup",...t.panelPos});0,p=r.id,h=r.tabs&&r.tabs[0].id}}async function g(e="",t,r=!0){var n;if(t||(t=null===(n=await Object(b.a)())||void 0===n?void 0:n.id))try{await browser.tabs.sendMessage(t,"translate")}catch(t){r&&m(e)}else r&&m(e)}var y=r(21),L=r(55),x=r(46);async function P(e){return"normal"===(await browser.windows.get(e)).type}async function O(e){if(!e)return void browser.browserAction.setBadgeText({text:"off"});if(Object(x.a)(e))return void browser.browserAction.setBadgeText({text:""});const{domainBlackList:t,domainWhiteList:r}=await browser.storage.local.get(Object(u.a)(c.a,["domainBlackList","domainWhiteList"])),n=Object(y.c)(e,t,r);browser.browserAction.setBadgeText({text:n?"":"off"})}async function j(e){let t,r;if(e)t=e.tabId,r=e.windowId;else{const e=await Object(b.a)();if(!e)return void O();t=e.id,r=e.windowId}(null==r||await P(r))&&O(await Object(L.a)(t))}j(),browser.tabs.onActivated.addListener((e=>{j(e)})),browser.tabs.onUpdated.addListener(((e,t)=>{"loading"===t.status&&j()})),browser.windows.onFocusChanged.addListener((async e=>{e!==browser.windows.WINDOW_ID_NONE&&await P(e)&&j()})),browser.storage.onChanged.addListener(((e,t)=>{"local"===t&&(e.hasOwnProperty("domainBlackList")||e.hasOwnProperty("domainWhiteList"))&&j()}));var k=r(22),C=r(70),D=r(43);const R=browser.runtime.getURL("settings.html");browser.runtime.onMessage.addListener((e=>{switch(e.action){case"open options page":return void(e.suffix?browser.tabs.create({url:R+e.suffix}):browser.runtime.openOptionsPage());case"translate":return async function(e){const t=i(e.apiCode);if(!t)return{data:null,error:"不支持的翻译接口 "+e.apiCode};const r=await browser.storage.local.get(d);return t.translate(e.text,r.destination===r.secondDestination?r.destination:[r.destination,r.secondDestination],{source:e.source}).then((e=>({data:e,error:null})),(e=>({data:null,error:{code:e.code}})))}(e.data);case"audio":return async function(e){let t;if(l&&l.pause(),"string"==typeof e)t=e;else{const r=i(e.apiId);if(!r)return Promise.resolve({data:null,error:"不支持的翻译接口 "+e.apiId});try{t=await r.getTTS(e.text,e.source)}catch(e){return Promise.resolve({data:null,error:"获取语音地址时出错"})}}return new Promise((e=>{l=new Audio(t),l.addEventListener("canplay",(()=>{null==l||l.play(),e(void 0)})),l.addEventListener("error",(()=>{e({error:"播放错误"})}))}))}(e.url);case"open panel":return void m();case"update badge":return void j();case"save along panel size":return async function(){if(null==p)return!1;{const e=await browser.windows.get(p);return browser.storage.local.set({panelPos:Object(u.a)(e,["width","height","left","top"])}),!0}}();case"save history record":return void k.a.historyRecords.add(e.record);case"save favorite":return void k.a.favorites.add(e.record);case"is text in favorites":return Object(C.d)(e.text);case"delete record in favorites":return Object(C.a)(e.text);case"write to clipboard":return void Object(D.b)(e.text)}}));var B=r(27);const W=browser.runtime.getURL("/pdf-viewer/web/viewer.html"),I=Object(u.a)(c.a,["pdfAuto"]);function A(e){return W+"?file="+encodeURIComponent(e)}function M(e){return{redirectUrl:A(e.url)}}function U(e){var t;if("GET"!==e.method)return;let r,n;return null===(t=e.responseHeaders)||void 0===t||t.some((e=>{var t;switch(e.name.toLowerCase()){case"content-type":r=e.value;break;case"content-disposition":n=null===(t=e.value)||void 0===t?void 0:t.trim();break;default:return!(!r||!n)}})),r?(r=r.toLowerCase().split(";",1)[0].trim(),"application/pdf"!==r||n&&!n.startsWith("inline")?void 0:{redirectUrl:A(e.url)}):void 0}Object(B.a)(I,(e=>{null!=e.pdfAuto&&(e.pdfAuto?(browser.webRequest.onBeforeRequest.hasListener(M)||browser.webRequest.onBeforeRequest.addListener(M,{urls:["ftp://*/*.pdf","ftp://*/*.PDF","file://*/*.pdf","file://*/*.PDF"],types:["main_frame","sub_frame"]},["blocking"]),browser.webRequest.onHeadersReceived.hasListener(U)||browser.webRequest.onHeadersReceived.addListener(U,{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame"]},["blocking","responseHeaders"])):(browser.webRequest.onBeforeRequest.removeListener(M),browser.webRequest.onHeadersReceived.removeListener(U)))}));var _=r(260);const E={YouDao:"YouDaoWeb",BaiDu:"BaiDuWeb",Google:"GoogleWeb",GoogleCN:"GoogleWeb"};browser.runtime.onInstalled.addListener((async e=>{var t;if("update"===e.reason&&"6"===(null===(t=e.previousVersion)||void 0===t?void 0:t[0])){const e=await browser.storage.local.get(),t={};if(t.pdfAuto=null!=e.pdf&&e.pdf,e.disableSelection)t.domainBlackList=[{host:"*",path:"/*"}];else{const r=e.excludeDomains;Array.isArray(r)&&(t.domainBlackList=r.map((e=>({host:`*${"."===e[0]?"":"."}${e}`,path:"/*"}))))}null!=e.showBtn&&(t.button=e.showBtn);const r=e.defaultApi||"GoogleCN",n=E[r];n&&(t.selectedAPIs=[n]);const o=Object(_.a)(c.a.textList);let s=!1;e.ignoreChinese&&(o[0].enabled=!0,s=!0),e.ignoreNumLike||(o[1].enabled=!1,s=!0),s&&(t.textList=o),await browser.storage.local.clear(),browser.storage.local.set(t)}}));[{id:"translate",title:"翻译这段文本(&Z)",contexts:["selection"]},{id:"open-pdf-in-viewer",title:"在划词翻译中打开此 PDF (&P)",contexts:["all"],documentUrlPatterns:["chrome-extension://mhjfbmdgcfjbbpaeojofohoefgiehjai/*"]},{id:"open-link-in-viewer",title:"在划词翻译中打开此 PDF (&P)",contexts:["link"],targetUrlPatterns:["*://*/*.pdf","*://*/*.PDF","*://*/*.pdf?*","*://*/*.PDF?*","ftp://*/*.pdf","ftp://*/*.PDF","ftp://*/*.pdf?*","ftp://*/*.PDF?*","file://*/*.pdf","file://*/*.PDF","file://*/*.pdf?*","file://*/*.PDF?*"]}].forEach((e=>{browser.contextMenus.create(e)})),browser.contextMenus.onClicked.addListener(((e,t)=>{switch(e.menuItemId){case"translate":const r=e.selectionText,n=e.pageUrl||"";r&&(n.startsWith("chrome")||n.startsWith("about")?m(r):g(r,null==t?void 0:t.id));break;case"open-pdf-in-viewer":const o=e.srcUrl;o&&!o.startsWith("about:")?browser.tabs.create({url:A(o)}):Object(x.b)("?_blocked");break;case"open-link-in-viewer":e.linkUrl&&browser.tabs.create({url:A(e.linkUrl)})}})),browser.commands.onCommand.addListener((e=>{switch(e){case"panel":m();break;case"translate":g("",void 0,!1)}}))},27:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(92);const o=[];function s(e,t,r,n="local"){return browser.storage[n].get(e).then((e=>{(r||t)(e,!0)})).then((()=>{const r=Object.keys(e);o.push({defaultOptions:e,onChange:t,area:n,keys:r})})),()=>{const r=o.findIndex((r=>r.onChange===t&&r.area===n&&r.defaultOptions===e));return r>=0&&(o.splice(r,1),!0)}}browser.storage.onChanged.addListener(((e,t)=>{o.forEach((r=>{if(r.area!==t)return;const o=function(e,t){const r={};for(const n in e)e.hasOwnProperty(n)&&t.includes(n)&&(r[n]=e[n].newValue);return r}(e,r.keys);Object(n.a)(o)||r.onChange(o)}))}))},37:function(e,t,r){"use strict";async function n(){return(await browser.tabs.query({active:!0,highlighted:!0,windowId:browser.windows.WINDOW_ID_CURRENT}))[0]}r.d(t,"a",(function(){return n}))},43:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return i}));var n=r(118);let o,s=()=>{s=n.a,o=document.createElement("textarea"),o.style.position="absolute",o.style.top="-99999px",document.body.appendChild(o)};function a(e){s(),o.value=e,o.select(),document.execCommand("copy")}function i(){return s(),o.value="",o.focus(),document.execCommand("paste"),o.value}},46:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s}));const n=browser.runtime.getURL("/pdf-viewer/web/viewer.html");function o(e){return e.startsWith(n)}function s(e=""){browser.tabs.create({url:n+e})}},55:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s}));var n=r(37);async function o(e){var t;try{let t;if(t=void 0===e?(await browser.tabs.executeScript({code:"window.location.href",runAt:"document_start"}))[0]:(await browser.tabs.executeScript(e,{code:"window.location.href",runAt:"document_start"}))[0],t.startsWith("moz-extension"))throw new Error;return t}catch(r){if(void 0===e&&!(e=null===(t=await Object(n.a)())||void 0===t?void 0:t.id))return;try{return await browser.tabs.sendMessage(e,"get tab url")}catch(e){}}}function s(){const e=e=>{if("get tab url"===e)return Promise.resolve(window.location.href)};return browser.runtime.onMessage.addListener(e),()=>{browser.runtime.onMessage.removeListener(e)}}},7:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o}));const n={button:!0,modifierKey:!0,domainBlackList:[],domainWhiteList:[],textList:[{name:"忽略中文",readonly:!0,enabled:!1,value:"[\\u4e00-\\u9fa5]",description:"如果划选的文本当中包含中文，则不弹出翻译按钮或翻译结果。"},{name:"忽略字符",readonly:!0,enabled:!0,value:"^[\\s.\\-0-9()•+]+$",description:"如果划选的文本全部都是由数字、点、括号、空格、横线、加号和圆点（即 •，多用于密码框）组成的，则不弹出翻译按钮或翻译结果。"}],placement:"bottom",pin:!1,pinPos:null,darkMode:"system",pdfAuto:!0,width:250,destination:"中文(简体)",secondDestination:"英语",showTextArea:!1,selectedAPIs:["BaiDuWeb"],autoClipboard:!0,autoPlay:!1,autoCopy:!1,recentUseLangFrom:[""],recentUseLangTo:["中文(简体)"],tipPanelSettingsClosed:!1,tipBlockedPDFClosed:!1,panelPos:{width:270,height:500,left:100,top:100},notifySyncOptions:!0,sourceTransformNoBr:!1,sourceTransformNCaml:!1,historyEnabled:!1,historySyncEnabled:!1,favoritesEnabled:!0,favoritesSyncEnabled:!1},o={user:null,optionsSyncAt:null,disabledNofiByBrowserUI:!1}},70:function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"d",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"c",(function(){return i})),r.d(t,"e",(function(){return c}));var n=r(22);function o(e){return n.a.favorites.bulkDelete(e)}async function s(e){return await n.a.favorites.where("text").equalsIgnoreCase(e).count()>0}function a(e){return n.a.favorites.where("text").equalsIgnoreCase(e).delete()}function i(){return n.a.favorites.clear()}function c(e,t,r){const o=t?n.a.favorites.where("date").below(t).reverse():n.a.favorites.orderBy("date").reverse();if(r){const e=r.toLocaleLowerCase();o.filter((t=>!!t.text.toLocaleLowerCase().includes(e)||Object.keys(t.results).some((r=>{var n,o;const s=t.results[r];return!!s&&(!!(null===(n=s.dict)||void 0===n?void 0:n.some((t=>t.terms.some((t=>t.includes(e))))))||!!(null===(o=s.result)||void 0===o?void 0:o.some((t=>t.includes(e)))))}))))}return o.limit(e).toArray()}}});